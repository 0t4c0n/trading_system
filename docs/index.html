<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conservative Trading Bot - An√°lisis Semanal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
        }
        
        .title-section {
            flex: 1;
            text-align: left;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .creator-section {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 16px;
            border-radius: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .creator-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .creator-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .creator-info {
            text-align: right;
            line-height: 1.2;
        }
        
        .creator-name {
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .creator-label {
            font-size: 0.8em;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .summary {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .summary-item {
            background: white;
            padding: 12px 8px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .summary-number {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .summary-number.success {
            color: #27ae60;
        }
        
        .summary-number.warning {
            color: #f39c12;
        }
        
        .summary-number.info {
            color: #3498db;
        }
        
        .summary-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .analysis-sections {
            padding: 20px;
        }
        
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "üìä";
            margin-right: 8px;
        }
        
        .section-title.consistency::before {
            content: "üèÜ";
        }
        
        .section-title.rotation::before {
            content: "üîÑ";
        }
        
        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #27ae60;
        }
        
        .consistency-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .consistency-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .consistency-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
        }
        
        .consistency-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .symbol-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .symbol-badge {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .symbol-badge.candidate {
            background: linear-gradient(135deg, #3498db, #5dade2);
        }
        
        .symbol-badge.emerging {
            background: linear-gradient(135deg, #f39c12, #f7dc6f);
        }
        
        .rotation-section {
            margin-bottom: 15px;
        }
        
        .rotation-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .rotation-title.hold::before {
            content: "‚úÖ";
            margin-right: 8px;
        }
        
        .rotation-title.buy::before {
            content: "üî•";
            margin-right: 8px;
        }
        
        .rotation-title.exit::before {
            content: "‚ö†Ô∏è";
            margin-right: 8px;
        }
        
        .action-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 4px 8px 4px 0;
        }
        
        .action-badge.no-action {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .action-badge.evaluate {
            background: #fff3cd;
            color: #856404;
        }
        
        .action-badge.action-required {
            background: #f8d7da;
            color: #721c24;
        }
        
        .market-context {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .market-context h4 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .spy-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .spy-metric {
            background: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .spy-value {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .spy-value.positive {
            color: #27ae60;
        }
        
        .spy-value.negative {
            color: #e74c3c;
        }
        
        .spy-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 2px;
        }
        
        .last-update {
            text-align: center;
            padding: 15px;
            font-size: 0.8em;
            color: #666;
            background: #f8f9fa;
        }
        
        .signature {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e9ecef;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 500;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .title-section {
                text-align: center;
            }
            
            .creator-section {
                order: -1;
                align-self: center;
                padding: 12px 18px;
                gap: 15px;
            }
            
            .creator-avatar {
                width: 70px;
                height: 70px;
                border-width: 4px;
            }
            
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .consistency-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .spy-metrics {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="title-section">
                    <h1>üìà Conservative Trading Bot</h1>
                    <div class="subtitle">An√°lisis Semanal para Largo Plazo</div>
                </div>
                <div class="creator-section">
                    <div class="creator-avatar">
                        <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxITEhUTExMVFhUXFxcVFRUVFxUVFRcVFRgXFxcXFxUYHSggGBolGxUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OGhAQGi0dHx0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rN//AABEIAOkA2AMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAAFAQIDBAYAB//EAEUQAAEDAgMFBAcDCQYHAAAAAAEAAhEDIQQSMQVBUWFxIoGx8AYTEzKRocGz0eEUIzVCUmJyc/EkM3SCkrIVFiU0RMLS/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJBEBAQACAgIBBAMBAAAAAAAAAAECEQMhEjFBEyJRYQQycUL/2gAMAwEAAhEDEQH/ABB9djbX+fio8g3Ks6sTuXe3gelen0zLVpIdjqdnWvbTuVo176lVMXWInu+izy0NAQprim=" alt="0t4c0n" id="creator-img">
                    </div>
                    <div class="creator-info">
                        <div class="creator-name">0t4c0n</div>
                        <div class="creator-label">Creator</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="content">
            <div class="loading">
                <div>üîÑ Cargando an√°lisis conservador...</div>
            </div>
        </div>
    </div>
    
    <button class="refresh-btn" onclick="loadData()" title="Actualizar datos">
        üîÑ
    </button>

    <script>
        let lastUpdateTime = null;
        
        function getNextUpdateTime() {
            const now = new Date();
            const nextMonday = new Date(now);
            
            // Calcular pr√≥ximo lunes
            const daysUntilMonday = (1 + 7 - now.getDay()) % 7;
            if (daysUntilMonday === 0 && now.getHours() < 14) {
                // Si es lunes y antes de las 2 PM, el pr√≥ximo an√°lisis es hoy
                nextMonday.setHours(14, 0, 0, 0);
            } else {
                nextMonday.setDate(now.getDate() + (daysUntilMonday || 7));
                nextMonday.setHours(14, 0, 0, 0);  // 2 PM UTC
            }
            
            return nextMonday.toLocaleString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        async function loadData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error('No se pudieron cargar los datos');
                
                const data = await response.json();
                renderConservativeDashboard(data);
                
            } catch (error) {
                console.error('Error loading data:', error);
                
                // Fallback: mostrar datos de ejemplo
                const fallbackData = {
                    "timestamp": new Date().toISOString(),
                    "market_date": new Date().toISOString().split('T')[0],
                    "summary": {
                        "analysis_type": "Conservative Long-term",
                        "total_analyzed": 150,
                        "passed_filters": 12,
                        "consistent_winners": 5,
                        "strong_candidates": 3,
                        "message": "Testing local - Sin datos reales"
                    },
                    "consistency_analysis": {
                        "weeks_analyzed": 5,
                        "consistent_winners": ["AAPL", "NVDA", "GOOGL", "MSFT", "META"],
                        "strong_candidates": ["TSLA", "AMZN", "CRM"],
                        "newly_emerged": ["ASML", "NOW"]
                    },
                    "rotation_recommendations": {
                        "overall_action": "EVALUATE_CHANGES",
                        "strong_buys": ["NVDA", "GOOGL"],
                        "consider_exits": ["AMD"],
                        "urgent_exits": [],
                        "holds": ["AAPL", "MSFT"]
                    },
                    "market_context": {
                        "spy_20d": 2.3,
                        "spy_60d": 8.7,
                        "spy_90d": 12.4
                    }
                };
                
                console.log('Usando datos de fallback para testing local');
                renderConservativeDashboard(fallbackData);
                
                // Mostrar informaci√≥n de error
                const errorInfo = document.createElement('div');
                errorInfo.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 20px; color: #856404;">
                        <strong>‚ö†Ô∏è Modo Testing Local</strong><br>
                        <small>
                            No se pueden cargar datos reales desde archivo local.<br>
                            Para datos reales, ejecuta desde servidor HTTP.<br>
                        </small>
                    </div>
                `;
                document.getElementById('content').appendChild(errorInfo);
            }
        }
        
        function renderConservativeDashboard(data) {
            const contentEl = document.getElementById('content');
            
            // Resumen
            const summaryHtml = `
                <div class="summary">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-number info">${data.summary.passed_filters}</div>
                            <div class="summary-label">Filtradas</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number success">${data.summary.consistent_winners}</div>
                            <div class="summary-label">Winners</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number warning">${data.summary.strong_candidates}</div>
                            <div class="summary-label">Candidates</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Secciones de an√°lisis
            let analysisHtml = `<div class="analysis-sections">`;
            
            // An√°lisis de consistencia
            if (data.consistency_analysis) {
                analysisHtml += `
                    <div class="analysis-card">
                        <div class="section-title consistency">An√°lisis de Consistencia (${data.consistency_analysis.weeks_analyzed} semanas)</div>
                        
                        <div class="consistency-grid">
                            <div class="consistency-item">
                                <div class="consistency-number">${data.consistency_analysis.consistent_winners.length}</div>
                                <div class="consistency-label">Consistent Winners</div>
                            </div>
                            <div class="consistency-item">
                                <div class="consistency-number">${data.consistency_analysis.strong_candidates.length}</div>
                                <div class="consistency-label">Strong Candidates</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">üèÜ Consistent Winners:</div>
                            <div class="symbol-list">
                                ${data.consistency_analysis.consistent_winners.map(symbol => 
                                    `<span class="symbol-badge">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">üíé Strong Candidates:</div>
                            <div class="symbol-list">
                                ${data.consistency_analysis.strong_candidates.map(symbol => 
                                    `<span class="symbol-badge candidate">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        ${data.consistency_analysis.newly_emerged.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">üÜï Newly Emerged:</div>
                            <div class="symbol-list">
                                ${data.consistency_analysis.newly_emerged.map(symbol => 
                                    `<span class="symbol-badge emerging">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Recomendaciones de rotaci√≥n
            if (data.rotation_recommendations) {
                const overallAction = data.rotation_recommendations.overall_action;
                let actionBadgeClass = 'no-action';
                let actionText = 'Sin acci√≥n requerida';
                
                if (overallAction === 'ACTION_REQUIRED') {
                    actionBadgeClass = 'action-required';
                    actionText = 'Acci√≥n requerida';
                } else if (overallAction === 'EVALUATE_CHANGES') {
                    actionBadgeClass = 'evaluate';
                    actionText = 'Evaluar cambios';
                }
                
                analysisHtml += `
                    <div class="analysis-card">
                        <div class="section-title rotation">Recomendaciones de Rotaci√≥n</div>
                        
                        <div style="margin-bottom: 15px;">
                            <span class="action-badge ${actionBadgeClass}">${actionText}</span>
                        </div>
                `;
                
                if (data.rotation_recommendations.holds.length > 0) {
                    analysisHtml += `
                        <div class="rotation-section">
                            <div class="rotation-title hold">Mantener:</div>
                            <div class="symbol-list">
                                ${data.rotation_recommendations.holds.map(symbol => 
                                    `<span class="symbol-badge">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                if (data.rotation_recommendations.strong_buys.length > 0) {
                    analysisHtml += `
                        <div class="rotation-section">
                            <div class="rotation-title buy">Compra fuerte:</div>
                            <div class="symbol-list">
                                ${data.rotation_recommendations.strong_buys.map(symbol => 
                                    `<span class="symbol-badge">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                if (data.rotation_recommendations.consider_exits.length > 0) {
                    analysisHtml += `
                        <div class="rotation-section">
                            <div class="rotation-title exit">Considerar salida:</div>
                            <div class="symbol-list">
                                ${data.rotation_recommendations.consider_exits.map(symbol => 
                                    `<span class="symbol-badge emerging">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                if (data.rotation_recommendations.urgent_exits.length > 0) {
                    analysisHtml += `
                        <div class="rotation-section">
                            <div class="rotation-title exit">Salida urgente:</div>
                            <div class="symbol-list">
                                ${data.rotation_recommendations.urgent_exits.map(symbol => 
                                    `<span class="symbol-badge" style="background: #e74c3c;">${symbol}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                analysisHtml += `</div>`;
            }
            
            // Contexto de mercado
            if (data.market_context) {
                analysisHtml += `
                    <div class="market-context">
                        <h4>üìä Contexto SPY</h4>
                        <div class="spy-metrics">
                            <div class="spy-metric">
                                <div class="spy-value ${data.market_context.spy_20d >= 0 ? 'positive' : 'negative'}">
                                    ${data.market_context.spy_20d >= 0 ? '+' : ''}${data.market_context.spy_20d.toFixed(1)}%
                                </div>
                                <div class="spy-label">20 d√≠as</div>
                            </div>
                            <div class="spy-metric">
                                <div class="spy-value ${data.market_context.spy_60d >= 0 ? 'positive' : 'negative'}">
                                    ${data.market_context.spy_60d >= 0 ? '+' : ''}${data.market_context.spy_60d.toFixed(1)}%
                                </div>
                                <div class="spy-label">60 d√≠as</div>
                            </div>
                            <div class="spy-metric">
                                <div class="spy-value ${data.market_context.spy_90d >= 0 ? 'positive' : 'negative'}">
                                    ${data.market_context.spy_90d >= 0 ? '+' : ''}${data.market_context.spy_90d.toFixed(1)}%
                                </div>
                                <div class="spy-label">90 d√≠as</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            analysisHtml += `</div>`;
            
            // Footer
            const updateTime = new Date(data.timestamp).toLocaleString('es-ES');
            const footerHtml = `
                <div class="last-update">
                    üìÖ √öltima actualizaci√≥n: ${updateTime}<br>
                    üóìÔ∏è Fecha de an√°lisis: ${data.market_date}<br>
                    ‚è∞ Pr√≥ximo an√°lisis: ${getNextUpdateTime()}<br>
                    <div class="signature">
                        <small>üöÄ Conservative Trading Bot by <strong>0t4c0n</strong></small>
                    </div>
                </div>
            `;
            
            contentEl.innerHTML = summaryHtml + analysisHtml + footerHtml;
        }
        
        // Cargar datos al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
        
        // Auto-refresh cada 5 minutos si est√° activo
        setInterval(() => {
            if (document.hasFocus()) {
                loadData();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
